<!DOCTYPE html>
<html>
<head>
    <title>3人行--资料</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="../themes/css/style.css">
</head>
<body class="my-info">
<article>
    <header class="my-info-hd">
        <h2 class="show"><em>我的资料</em></h2>
        <h2><em>我的技能</em></h2>
        <h2><em>我的想学</em></h2>
    </header>
    <section class="my-info-bd">
        <div class="my-info-step1">
            <ul>
                <li><input type="text" placeholder="昵称："></li>
                <li><label><em>男男男男</em><select><option>男</option><option>女</option></select></label></li>
                <li><input type="text" placeholder="微信号："></li>
                <li class="my-info-site">
                    <label><em>浙江省</em><select><option>浙江省</option><option>湖北省</option></select></label>
                    <label><em>杭州市</em><select><option>杭州市</option><option>温州市</option></select></label>
                    <label><em>滨江区</em><select><option>滨江区</option><option>西湖区</option></select></label>
                </li>
            </ul>
            <a href="javascript:;" class="my-info-btn">下一步</a>
        </div>
        <div class="my-info-step2">
            <div class="clearfix">
                <a href="javascript:;" class="my-info-del" title="删除">-</a>
                <a href="javascript:;" class="my-info-add" title="添加">+</a>
            </div>
            <ul>
                <li><input type="text" placeholder="技能名称："></li>
                <li><label>熟练程度：<em>10分</em><select><option>10分</option><option>9分</option></select></label></li>
                <li><a href="javascript:;" class="del-btn">删除</a></li>
            </ul>
            <a href="javascript:;" class="my-info-btn">下一步</a>
        </div>
        <div class="my-info-step3">
            <div class="clearfix">
                <a href="javascript:;" class="my-info-del" title="删除">-</a>
                <a href="javascript:;" class="my-info-add" title="添加">+</a>
            </div>
            <ul>
                <li><input type="text" placeholder="我的想学："><a href="javascript:;" class="del-btn">删除</a></li>
                <li><input type="text" placeholder="我的想学："><a href="javascript:;" class="del-btn">删除</a></li>
            </ul>
            <a href="javascript:;" class="my-info-btn">完成</a>
        </div>
    </section>
</article>
<script src="../js/libs/sea.js"></script>
<script>
    seajs.config({
        alias:{
            'zepto':'zepto.min.js',
            'gmu':'gmu.min.js'
        }
    })
    seajs.use('zepto',function(){
        $(document.body).on('tap',function(e){
            var el = $(e.target);
            //下一步、完成
            if(el.hasClass('my-info-btn')){
                if(!el.closest('.my-info-step3').length){
                    el.parent().hide().next().show();
                    $('.my-info-hd').find('.show').removeClass('show').next().addClass('show');
                }else{
                    var json = {
                        skill : [],
                        want : []
                    };
                    var skill = $('.my-info-step2').find('ul');
                    for(var i=0; i<skill.length; i++){
                        json.skill.push({
                            "name":skill.eq(i).find('li').eq(0).find('input').val(),
                            "score":skill.eq(i).find('li').eq(1).find('input').val()
                        });
                    }
                    
                    var want = $('.my-info-step3').find('li');
                    for(var i=0; i<want.length; i++){
                        json.want.push({
                            "name":want.eq(i).find('input').val()
                        });
                    }
                    console.log(json);
                }
            }
            
            //添加项
            if(el.hasClass('my-info-add')){
                el.siblings('.my-info-del').show();
                if(el.closest('.my-info-step3').length){
                    el.parent().siblings('ul').prepend('<li><input type="text" placeholder="我的想学："><a href="javascript:;" class="del-btn">删除</a></li>')
                }else{
                    el.parent().after('<ul><li><input type="text" placeholder="技能名称："></li><li><label>熟练程度：<em>10分</em><select><option>10分</option><option>9分</option></select></label></li><li><a href="javascript:;" class="del-btn">删除</a></li></ul>');
                }
            }
            
            //删除
            if(el.hasClass('my-info-del')){
                el.parent().parent().toggleClass('my-info-remove');
            }
            
            //删除项
            if(el.hasClass('del-btn')){
                var step='';len=0;
                if(el.parents('.my-info-step2').length){
                    step = el.parents('.my-info-step2');
                    len = step.find('ul').length;
                    el.parent().parent().remove();
                }else if(el.parents('.my-info-step3').length){
                    step = el.parents('.my-info-step3');
                    len = step.find('ul li').length;
                    el.parent().remove();
                }
                if(len<=2){
                    step.removeClass('my-info-remove');
                    step.find('.my-info-del').hide();
                }
            }
            
        }).on('touchstart','.my-info-hd h2',function(){
            var _this = $(this);
            _this.addClass('show').siblings().removeClass('show');
            $('.my-info-bd').children().eq(_this.index()).show().siblings().hide();
        }).on('change','select',function(){
            var _this = $(this);
            _this.siblings('em').text(_this.val());
            
            if(_this.closest('.my-info-site').length){
                var i = $('.my-info-site select').index(this);
                var label = $('.my-info-site').find('label');
                for(i++;i<3;i++){console.log(i);
                    label.eq(i).find('em').text(label.eq(i).find('select').val());
                }
            }
        })
    });
</script>
</body>
</html>