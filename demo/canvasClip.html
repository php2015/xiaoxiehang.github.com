<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>canvas 截图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        *{margin:0;padding:0;}
        html,body{height:100%;overflow:hidden;}
        #demo{position:absolute;left:0;top:0;background:red;}
        .btns{z-index:2;position:fixed;bottom:5px;left:0;right:0;text-align: center;}
        .btns button{margin-right:10px;padding:5px;}
    </style>
</head>
<body>
<canvas id="demo"></canvas>
<div class="btns">
    <button id="rotate">旋转</button>
    <button id="add">+</button>
    <button id="minus">-</button>
</div>
<script>
    var canvas = document.getElementById('demo'),
        ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    var div = document.createElement('div');
    document.body.appendChild(div);
    div.setAttribute('style','z-index:1;position:fixed;top:0;left:0;width:300px;height:300px;border:solid rgba(0,0,0,.5);border-width:' +(canvas.height-300)/2 + 'px ' + (canvas.width-300)/2 +'px;');
    
    
    //ctx.globalCompositeOperation = 'destination-out';
    var img = new Image();
    img.addEventListener('load',function(){
        
        var w = img.width,
            h = img.height,
            prop = w>h ? w/h : h/w;
        
        
        var propW, propH, s1;
        var x = y = 0;
        
        function rotate(deg,scale,tx,ty){
            ctx.clearRect(0,0,canvas.width,canvas.height)
            ctx.save();
            deg *= 90;
            ctx.rotate(deg*Math.PI/180);
            
            var ss = scale || 1;
            if(!deg){
                propW = w/canvas.width,
                propH = h/canvas.height;
                s1 = propW>propH ? propW : propH;
                x = (canvas.width - w/s1*ss)/2;
                y = (canvas.height - h/s1*ss)/2;
            }else if(deg == 90){
                propW = w/canvas.height;
                propH = h/canvas.width;
                s1 = propW>propH ? propW : propH;
                x = (canvas.height - w/s1*ss)/2;
                y = -(canvas.width + h/s1*ss)/2;
            }else if(deg == 180){
                propW = w/canvas.width,
                propH = h/canvas.height;
                s1 = propW>propH ? propW : propH;
                x = -(canvas.width + w/s1*ss)/2;
                y = -(canvas.height + h/s1*ss)/2;
            }else if(deg == 270){
                propW = w/canvas.height;
                propH = h/canvas.width;
                s1 = propW>propH ? propW : propH;
                x = -(canvas.height + w/s1*ss)/2;
                y = (canvas.width - h/s1*ss)/2;
            }
            
            
            var xx = tx || x;
            var yy = ty || y;
            console.log(yy);
            ctx.drawImage(img, xx, yy, w/s1*ss, h/s1*ss);
            ctx.restore();
        }
        
        var i =0;
        rotate(0);
        window.onresize = function(){
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            rotate(i);
            div.style.borderWidth = (window.innerHeight-300)/2 + 'px ' + (window.innerWidth-300)/2 +'px';
        }
        
        var sss = 1;
        document.getElementById('rotate').onclick = function(){
            canvas.style.left = 0;
            canvas.style.top = 0;
            if(i>=3){
                i=0;
            }else{
                i++;
            }
            rotate(i,sss);
        }
        
        document.getElementById('add').onclick = function(){
            sss += 0.1;
            rotate(i,sss);
        }
        
        document.getElementById('minus').onclick = function(){
            sss -= 0.1;
            rotate(i,sss);
        }
        var px,py;
        window.addEventListener('touchstart',function(e){
            e.preventDefault();
            px = e.targetTouches[0].pageX;
            py = e.targetTouches[0].pageY;
            cx = canvas.offsetLeft;
            cy = canvas.offsetTop;
            console.log(x);
            console.log(y);
        })
        window.addEventListener('touchmove',function(e){
            e.preventDefault();
            
            var sx = e.targetTouches[0].pageX - px;
            var sy = e.targetTouches[0].pageY - py;
            
            rotate(i,sss,x+sx,y+sy);
//            canvas.style.left = cx + sx + 'px';
//            canvas.style.top = cy + sy + 'px';
        })
    })
    img.src = 'http://triptest.qiniudn.com/trip5.JPG';
    
    
</script>
</body>
</html>