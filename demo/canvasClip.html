<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>canvas 截图</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        *{margin:0;padding:0;}
        html,body{height:100%;overflow:hidden;}
        #demo{position:absolute;left:0;top:0;}
        .btns{z-index:2;position:fixed;bottom:5px;left:0;right:0;text-align: center;}
        .btns button{margin-right:10px;padding:5px;}
    </style>
</head>
<body>
<canvas id="demo"></canvas>
<div class="btns">
    <button id="rotate">旋转</button>
    <button id="add">+</button>
    <button id="minus">-</button>
</div>
<script>
    var canvas = document.getElementById('demo'),
        ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    var div = document.createElement('div');
    document.body.appendChild(div);
    div.setAttribute('style','z-index:1;position:fixed;top:0;left:0;width:300px;height:300px;border:solid rgba(0,0,0,.5);border-width:' +(canvas.height-300)/2 + 'px ' + (canvas.width-300)/2 +'px;');
    
    
    //ctx.globalCompositeOperation = 'destination-out';
    var img = new Image();
    img.addEventListener('load',function(){
        
        var w = img.width,
            h = img.height,
            prop = w>h ? w/h : h/w;
        
        
        var propW, propH, s1;
        
        function rotate(deg){
//            canvas.width = window.innerWidth;
//            canvas.height = window.innerHeight;
            ctx.clearRect(0,0,canvas.width,canvas.height)
            ctx.save();
            deg *= 90;
            ctx.rotate(deg*Math.PI/180);
            //ctx.translate(canvas.width/2,canvas.height/2);
            if(!deg){
                propW = w/canvas.width,
                propH = h/canvas.height;
                s1 = propW>propH ? propW : propH;
                ctx.drawImage(img, (canvas.width - w/s1)/2, (canvas.height - h/s1)/2, w/s1, h/s1);
                //ctx.drawImage(img, -(w/s1/2),-(h/s1/2), w/s1, h/s1);
            }else if(deg == 90){
                propW = w/canvas.height;
                propH = h/canvas.width;
                s1 = propW>propH ? propW : propH;
                ctx.drawImage(img, (canvas.height - w/s1)/2, -(canvas.width + h/s1)/2, w/s1, h/s1);
                //ctx.drawImage(img, (canvas.height - w/s1)/2 -canvas.width/2, -(canvas.width + h/s1)/2 - canvas.height/2, w/s1, h/s1);
//                console.log(-(canvas.width + h/s1)/2 - canvas.height/2)
//                console.log(-(canvas.width + h/s1)/2)
//                console.log(canvas.height/2)
            }else if(deg == 180){
                propW = w/canvas.width,
                propH = h/canvas.height;
                s1 = propW>propH ? propW : propH;
                ctx.drawImage(img, -(canvas.width + w/s1)/2, -(canvas.height + h/s1)/2, w/s1, h/s1);
            }else if(deg == 270){
                propW = w/canvas.height;
                propH = h/canvas.width;
                s1 = propW>propH ? propW : propH;
                ctx.drawImage(img, -(canvas.height + w/s1)/2, (canvas.width - h/s1)/2, w/s1, h/s1);
            }
            ctx.restore();
        }
        
        var i =0;
        rotate(0);
        document.getElementById('rotate').onclick = function(){
            
            canvas.style.left = 0;
            canvas.style.top = 0;
            if(i>=3){
                i=0;
            }else{
                i++;
            }
            rotate(i);
        }
        
        document.getElementById('add').onclick = function(){
            canvas.width = canvas.width*1.1;
            canvas.height = canvas.height*1.1;
            rotate(i);
        }
        
        document.getElementById('minus').onclick = function(){
            canvas.width = canvas.width/1.1;
            canvas.height = canvas.height/1.1;
            rotate(i);
        }
        var px,py;
        window.addEventListener('touchstart',function(e){
            px = e.targetTouches[0].pageX;
            py = e.targetTouches[0].pageY;
            cx = canvas.offsetLeft;
            cy = canvas.offsetTop;
        })
        window.addEventListener('touchmove',function(e){
             console.log(px);
             console.log(py);
             console.log(cx);
             console.log(cy);
            canvas.style.left = cx + e.targetTouches[0].pageX - px + 'px';
            canvas.style.top = cy + e.targetTouches[0].pageY - py + 'px';
        })
    })
    img.src = 'http://triptest.qiniudn.com/trip13.JPG';
    
</script>
</body>
</html>